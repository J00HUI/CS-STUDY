> 스패닝 트리

앞서 소개한 역방향 학습 알고리즘을 이용하면 라우팅 정보를 효과적으로 얻을 수 있다.     
그러나 다음 그림처럼 네트워크에 이중 경로가 존재하면 잘못된 라우팅 정보를 얻을 수 있다.      

<그림 p.102>

* 예를 들어, 그림에 소개한 네트워크의 초기 동작에서 브리지 B1과 브리지 B2는 플러딩 알고리즘을 사용해 프레임을 전달한다.
* 호스트 a가 임의의 수신 호스트에 프레임을 전달한다고 가정해보자.
* 호스트 a가 보낸 프레임은 브리지 B1의 1번 포트로 전달되므로, 브리지 B1의 라우팅 테이블에는 호스트 a가 1번 포트로 연결된 것으로 등록된다.
* 동시에 호스트 a가 보낸 프레임은 브리지 B2를 통해 브리지 B1의 2번 포트로도 들어온다.
* 결과적으로, 브리지 B1에서는 호스트 a가 보낸 프레임이 1번과 2번 포트 두 군데에서 다 들어오므로 모순된 라우팅 테이블이 만들어진다.
* 브리지 B2에도 동일한 원리가 적용되고, 호스트 a가 두 포트에 모두 연결된 것처럼 라우팅 정보가 만들어진다.
</br>

* 이후, 수신 호스트의 주소가 a로 지정된 프레임이 전송되면, 두 브리지는 데이터를 양쪽 포트로 전달하기 때문에 전송 프레임이 네트워크를 계속 순환하는 결과를 초래한다.
* 이런 문제점을 해결하려면 이중 경로가 존재하지 않도록 네트워크를 설계해야 한다.
* 네트워크의 설계 과정에서 순환 구조가 불가피하게 만들어진다면, 네트워크의 논리적인 연결 상태를 비순환 형태로 간주함으로써, 역방향 학습 알고리즘이 올바르게 동작하도록 해야 한다.
* 네트워크의 비순환 구조를 **스패닝 트리** (Spanning Tree)라 하고, 이를 지원하는 알고리즘을 스패닝 트리 알고리즘이라 한다.
```
스패닝 트리를 구성하려면, 먼저 임의의 브리지를 트리 구조의 최상위 브리지인 루트(Root)로 지정해야 한다.
이를 위해 브리지가 자신의 고유 번호를 서로 공개함으로써, 번호가 가장 낮은 브리지를 루트로 선정할 수 있다.
그런 다음, 루트 브리지에서 다른 모든 브리지까지의 최단 경로 트리를 구성하는 방식으로 LAN을 구축하는 과정을 밟는다.
```
</br>

### 1.2 소스 라우팅 브리지
트랜스페런트 브리지는 공유 버스에서 구현되는 CSMA/CD(Carrier Sense Multiple Access/Collision Detection) 방식과 토큰 버스 방식에서 사용한다.   
사용자 입장에서 보면 간편하지만, 효율적이지 못하다는 단점도 있다.   

일반적으로 소스 라우팅 브리지(Source Routing Bridge)는 링 구조의 네트워크에서 사용한다.   
이 방식은 이름처럼 프레임이 수신 호스트까지 도달하기 위한 라우팅 정보를 송신 호스트가 제공한다.   
즉, 송신 프레임 내부에 수신 호스트까지 도달하기 위한 모든 경로를 기술함으로써, 중간 브리지에 필요한 라우팅 정보가 프레임 자체에 포함된다.   
프레임을 수신한 브리지는 이 정보를 이용해 프레임을 적절한 경로로 전달한다.    
</br>

### 2. IP 네트워킹
인터넷 환경에서 IP 프로토콜을 사용해 **IP 인터네트워킹** (IP Internetworking)을 지원하려면 그림처럼 라우터가 송수신 호스트 간의 여러 네트워크 인터페이스를 거쳐 패킷을 전달할 수 있어야 한다.   

<img width="614" alt="스크린샷 2021-08-09 오후 8 42 35" src="https://user-images.githubusercontent.com/83942393/128700944-b9698a34-1cf3-40b5-aef3-2e56bb4ca1ce.png">

* 그림에서는 라우터 A가 이더넷 인터페이스와 PPP 인터페이스를 지원하고, 라우터 B는 PPP와 [ATM](https://terms.naver.com/entry.naver?docId=815541&cid=42344&categoryId=42344) 인터페이스를 지원하다고 가정해였다.
* 이들을 이용해 이더넷과 ATM이라는 상이한 네트워크 인터페이스를 지원하는 사용자 간의 연결 구조가 가능함을 알 수 있다.
* 패킷을 올바르게 중개하기 위해 라우터들은 IP 프로토콜까지의 계층 기능을 지원하고, 송수신 호스트는 TCP/IP 응용 프로그램을 이용해 통신한다.
</br>

* 라우터에는 양쪽의 MAC 계층의 차이를 해결하는 기능이 필요하다.
* 그림처럼 라우터 A 는 입력된 이더넷 헤더를 PPP 헤더로 변환하고, 라우터 B는 PPP 헤더를 ATM 헤더로 변환해주어야 한다.

<img width="684" alt="스크린샷 2021-08-09 오후 8 56 46" src="https://user-images.githubusercontent.com/83942393/128702518-2e434969-2605-4c0c-bf4f-ddee0cd25e22.png">

```
데이터가 반대 방향으로 전달되는 경우에는 헤더 변환 과정이 반대로 이루어진다.
```
* 라우터에 연결된 네트워크가 동일한 종류의 MAC 계층을 사용하면 MAC 헤더의 변환 과정은 이루어지지 않는다.
* 헤더 변환 과정과는 별도로, 라우터를 거치는 동안에 전송되는 패킷이 특정 MAC 계층에서 전송하기에 너무 크면, 패킷의 분할과 병합 과정이 이루어진다.
</br>

### 3. 인터넷 라우팅
* 라우터의 역할은 수신된 IP 데이터그램을 적절한 경로로 전달하는 것이다.
* 그러려면 인터넷의 전체 구성과 현재 상태에 대한 정보를 활용해 경로를 선택해야 한다.
* 대표적인 라우팅 방식으로 고정 경로 배정과 적응 경로 배정이 있다. 
</br>

### 3.1 고정 경로 배정
* 고정 경로 배정(Fixed Routing)은 간단한 구현만으로도 효과적인 라우팅이 가능한 방법으로, 송수신 호스트 사이에 영구불변의 경로를 배정한다.   
* 단점은 전송 경로가 고정되므로, 트래픽 변화에 따른 동적 경로 배정이 불가능하다는 점이다.   
* 그러나, 송수신 호스트 사이의 트래픽을 미리 측정하여 고정 경로를 적절히 배정하면 간단하고 효율적인 라우팅이 가능하다.   

예를 들어 다음 그림과 같은 네트워크를 가정해보자.   
<img src="https://user-images.githubusercontent.com/83942393/128703384-2c694242-9fcf-4e30-a2af-1b146db25e2e.png" width="45%" height="45%"></img> <img src="https://user-images.githubusercontent.com/83942393/128703424-84a9028f-8d8c-4a29-911a-b67fca3c601f.png" width="45%" height="45%"></img>

* 라우터 주위의 숫자는 연결하는 라우터의 포트 번호이다.
* 각 라우터가 관리하는 라우팅 정보는 표처럼 결정되는데, 경로 배정은 네트워크를 연결하는 선로의 전송 용량이나 네트워크 간의 데이터 전송량을 측정해 이루어진다.
* 그림에서는 라우터 R3과 R7로 연결한 선로가 다른 선로보다 고속 통신을 지원하며, 라우터 R1, R4, R6이 연결된 네트워크 Net.2가 라우터 R2, R5, R8 쪽의 네트워크 Net.4보다 덜 붐빈다고 가정하였다.
</br>

* 라우팅 테이블의 값은 목적지 네트워크의 주소와 해당 목적지로 향하는 경로 위에 있는 다음 라우터의 주소이다.
* 각 네트워크 내부에 존재하는 호스트에도 그림과 같은 형태의 라우팅 테이블이 존재한다.
```
예를 들어, Net.1에 존재하는 호스트가 Net.5에 존재하는 호스트에 데이터를 전송한다고 가정하자.

먼저 Net.1에 존재하는 호스트의 라우팅 테이블에 목적지가 Net.5인 데이터는 라우터 R1로 전송하라고 되어 있다면, 해당 데이터는 R1으로 간다.
라우터 R1의 라우팅 테이블을 보면, Net.5로 가는 데이터는 라우터 R6으로 중개하도록 되어 있으므로, 데이터는 라우터 R6으로 전달된다.

최종 경로는 R1 -> Net.2 -> R6 -> Net.5 순서이다.
```
</br>

### 3.2 적응 경로 배정
고정 경로 배정에서 라우팅 테이블의 경로 정보 변경은 네트워크 구성이 변경된 경우에만 가능하다.   
인터넷에서 사용되는 라우터는 **적응 경로 배정** (Adaptive Routing)을 채택한다.   

적응 경로 배정에서는 인터넷 연결 상태가 변하면 이를 데이터그램의 전달 경로에 반영한다.   
이때 결정에 영향을 주는 요소는 크게 두 가지이다.   
하나는 특정 네트워크나 라우터가 정상적으로 동작하지 않는 경우이고,   
다른 하나는, 네트워크의 특정 위치에서 혼잡이 발생하는 경우이다.   

적응 경로 배정은 이론적인 타당성에도 불구하고, 가볍게 넘길 수 없는 단점이 있다.   
경로를 결정하는 과정이 복잡해지면 이를 처리하는 라우터의 부담이 증가하는데, 인터넷처럼 복잡한 망에서 이것은 상당히 부담스러운 작업이다.   

네트워크에서의 변화는 내부적으로, 상태 정보에 대한 처리를 수반한다.   
그러나 특정 위치에서 어떤 변화가 발생했을 때, 네트워크의 모든 라우터에 동시 반영하는 것은 현실적으로 불가능하므로, 라우터들끼리 불일치성(Inconsistency)이 발생할 수 있다.   
이러한 불일치성을 해소하려면 라우터 사이의 정보 교환이 빠르게 자주 이루어져야 한다.    
하지만 이것은 네트워크 트래픽을 증가시키고, 라우터의 처리 부담을 증가시키는 결과를 초래한다.   
</br>

### 3.3 자율 시스템
라우팅 프로토콜과 관련해 자율 시스템(Autonomous System)이라는 개념이 존재한다.   
자율 시스템은 다수의 라우터로 구성할 수 있으며, 라우터들은 서로 공통의 라우팅 프로토콜을 사용해 정보를 교환한다.   
자율 시스템은 동일한 라우팅 특성에 의해 동작하는 논리적인 단일 구성체라고 볼 수 있다.   

자율 시스템 내부에서 사용하는 공통 프로토콜을 **내부 라우팅 프로토콜** (IRP, Interior Routing Protocol)이라 하며, 라우터끼리 라우팅 정보를 교환하는 용도로 사용한다.   

학교 같은 인터넷 환경에서는 각 건물을 라우터로 연결해 자율 시스템을 구성할 수 있고, 그림과 같이 외부의 자율 시스템과도 연결한다.
<img width="519" alt="스크린샷 2021-08-09 오후 9 43 33" src="https://user-images.githubusercontent.com/83942393/128707946-45eac333-7819-41e9-a557-00eda2f41dde.png">

이러한 구조에서는 자율 시스템이 사용하는 알고리즘과 라우팅 테이블 정보의 구조가 다를 수 있으므로, 자율 시스템 사이의 연동을 위한 방안을 고려해야 한다.   
자율 시스템들 간에 사용하는 라우팅 프로토콜을 일반적으로 **외부 라우팅 프로토콜**(ERP, Exterior Routing Protocol)이라 한다.   

그림에서 동일한 자율 시스템에 위치한 라우터 사이에는 내부 라우팅 프로토콜을 사용하고, 서로 다른 자율 시스템을 연결하는 라우터 사이에는 외부 라우팅 프로토콜을 사용한다.   
내부 라우팅 프로토콜에는 RIP, OSPF 등이 있고, 외부 라우팅 프로토콜에는 BGP 등이 있다.   
</br>

### 💎 04 서비스 품질(QoS)

 









