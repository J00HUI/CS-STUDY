> 스패닝 트리

앞서 소개한 역방향 학습 알고리즘을 이용하면 라우팅 정보를 효과적으로 얻을 수 있다.     
그러나 다음 그림처럼 네트워크에 이중 경로가 존재하면 잘못된 라우팅 정보를 얻을 수 있다.      

<img src="https://user-images.githubusercontent.com/83942393/129304129-ef3885de-b38b-44de-b79f-72ef3aa18096.jpg" width="60%" height="60%"></img></br>

* 예를 들어, 그림에 소개한 네트워크의 초기 동작에서 브리지 B1과 브리지 B2는 플러딩 알고리즘을 사용해 프레임을 전달한다.
* 호스트 a가 임의의 수신 호스트에 프레임을 전달한다고 가정해보자.
* 호스트 a가 보낸 프레임은 브리지 B1의 1번 포트로 전달되므로, 브리지 B1의 라우팅 테이블에는 호스트 a가 1번 포트로 연결된 것으로 등록된다.
* 동시에 호스트 a가 보낸 프레임은 브리지 B2를 통해 브리지 B1의 2번 포트로도 들어온다.
* 결과적으로, 브리지 B1에서는 호스트 a가 보낸 프레임이 1번과 2번 포트 두 군데에서 다 들어오므로 모순된 라우팅 테이블이 만들어진다.
* 브리지 B2에도 동일한 원리가 적용되고, 호스트 a가 두 포트에 모두 연결된 것처럼 라우팅 정보가 만들어진다.
</br>

* 이후, 수신 호스트의 주소가 a로 지정된 프레임이 전송되면, 두 브리지는 데이터를 양쪽 포트로 전달하기 때문에 전송 프레임이 네트워크를 계속 순환하는 결과를 초래한다.
* 이런 문제점을 해결하려면 이중 경로가 존재하지 않도록 네트워크를 설계해야 한다.
* 네트워크의 설계 과정에서 순환 구조가 불가피하게 만들어진다면, 네트워크의 논리적인 연결 상태를 비순환 형태로 간주함으로써, 역방향 학습 알고리즘이 올바르게 동작하도록 해야 한다.
* 네트워크의 비순환 구조를 **스패닝 트리** (Spanning Tree)라 하고, 이를 지원하는 알고리즘을 스패닝 트리 알고리즘이라 한다.
```
스패닝 트리를 구성하려면, 먼저 임의의 브리지를 트리 구조의 최상위 브리지인 루트(Root)로 지정해야 한다.
이를 위해 브리지가 자신의 고유 번호를 서로 공개함으로써, 번호가 가장 낮은 브리지를 루트로 선정할 수 있다.
그런 다음, 루트 브리지에서 다른 모든 브리지까지의 최단 경로 트리를 구성하는 방식으로 LAN을 구축하는 과정을 밟는다.
```
</br>

### 1.2 소스 라우팅 브리지
트랜스페런트 브리지는 공유 버스에서 구현되는 CSMA/CD(Carrier Sense Multiple Access/Collision Detection) 방식과 토큰 버스 방식에서 사용한다.   
사용자 입장에서 보면 간편하지만, 효율적이지 못하다는 단점도 있다.   

일반적으로 소스 라우팅 브리지(Source Routing Bridge)는 링 구조의 네트워크에서 사용한다.   
이 방식은 이름처럼 프레임이 수신 호스트까지 도달하기 위한 라우팅 정보를 송신 호스트가 제공한다.   
즉, 송신 프레임 내부에 수신 호스트까지 도달하기 위한 모든 경로를 기술함으로써, 중간 브리지에 필요한 라우팅 정보가 프레임 자체에 포함된다.   
프레임을 수신한 브리지는 이 정보를 이용해 프레임을 적절한 경로로 전달한다.    
</br>

### 2. IP 네트워킹
인터넷 환경에서 IP 프로토콜을 사용해 **IP 인터네트워킹** (IP Internetworking)을 지원하려면 그림처럼 라우터가 송수신 호스트 간의 여러 네트워크 인터페이스를 거쳐 패킷을 전달할 수 있어야 한다.   

<img width="614" alt="스크린샷 2021-08-09 오후 8 42 35" src="https://user-images.githubusercontent.com/83942393/128700944-b9698a34-1cf3-40b5-aef3-2e56bb4ca1ce.png">

* 그림에서는 라우터 A가 이더넷 인터페이스와 PPP 인터페이스를 지원하고, 라우터 B는 PPP와 [ATM](https://terms.naver.com/entry.naver?docId=815541&cid=42344&categoryId=42344) 인터페이스를 지원하다고 가정해였다.
* 이들을 이용해 이더넷과 ATM이라는 상이한 네트워크 인터페이스를 지원하는 사용자 간의 연결 구조가 가능함을 알 수 있다.
* 패킷을 올바르게 중개하기 위해 라우터들은 IP 프로토콜까지의 계층 기능을 지원하고, 송수신 호스트는 TCP/IP 응용 프로그램을 이용해 통신한다.
</br>

* 라우터에는 양쪽의 MAC 계층의 차이를 해결하는 기능이 필요하다.
* 그림처럼 라우터 A 는 입력된 이더넷 헤더를 PPP 헤더로 변환하고, 라우터 B는 PPP 헤더를 ATM 헤더로 변환해주어야 한다.

<img width="684" alt="스크린샷 2021-08-09 오후 8 56 46" src="https://user-images.githubusercontent.com/83942393/128702518-2e434969-2605-4c0c-bf4f-ddee0cd25e22.png">

```
데이터가 반대 방향으로 전달되는 경우에는 헤더 변환 과정이 반대로 이루어진다.
```
* 라우터에 연결된 네트워크가 동일한 종류의 MAC 계층을 사용하면 MAC 헤더의 변환 과정은 이루어지지 않는다.
* 헤더 변환 과정과는 별도로, 라우터를 거치는 동안에 전송되는 패킷이 특정 MAC 계층에서 전송하기에 너무 크면, 패킷의 분할과 병합 과정이 이루어진다.
</br>

### 3. 인터넷 라우팅
* 라우터의 역할은 수신된 IP 데이터그램을 적절한 경로로 전달하는 것이다.
* 그러려면 인터넷의 전체 구성과 현재 상태에 대한 정보를 활용해 경로를 선택해야 한다.
* 대표적인 라우팅 방식으로 고정 경로 배정과 적응 경로 배정이 있다. 
</br>

### 3.1 고정 경로 배정
* 고정 경로 배정(Fixed Routing)은 간단한 구현만으로도 효과적인 라우팅이 가능한 방법으로, 송수신 호스트 사이에 영구불변의 경로를 배정한다.   
* 단점은 전송 경로가 고정되므로, 트래픽 변화에 따른 동적 경로 배정이 불가능하다는 점이다.   
* 그러나, 송수신 호스트 사이의 트래픽을 미리 측정하여 고정 경로를 적절히 배정하면 간단하고 효율적인 라우팅이 가능하다.   

예를 들어 다음 그림과 같은 네트워크를 가정해보자.   
<img src="https://user-images.githubusercontent.com/83942393/128703384-2c694242-9fcf-4e30-a2af-1b146db25e2e.png" width="45%" height="45%"></img> <img src="https://user-images.githubusercontent.com/83942393/128703424-84a9028f-8d8c-4a29-911a-b67fca3c601f.png" width="45%" height="45%"></img>

* 라우터 주위의 숫자는 연결하는 라우터의 포트 번호이다.
* 각 라우터가 관리하는 라우팅 정보는 표처럼 결정되는데, 경로 배정은 네트워크를 연결하는 선로의 전송 용량이나 네트워크 간의 데이터 전송량을 측정해 이루어진다.
* 그림에서는 라우터 R3과 R7로 연결한 선로가 다른 선로보다 고속 통신을 지원하며, 라우터 R1, R4, R6이 연결된 네트워크 Net.2가 라우터 R2, R5, R8 쪽의 네트워크 Net.4보다 덜 붐빈다고 가정하였다.
</br>

* 라우팅 테이블의 값은 목적지 네트워크의 주소와 해당 목적지로 향하는 경로 위에 있는 다음 라우터의 주소이다.
* 각 네트워크 내부에 존재하는 호스트에도 그림과 같은 형태의 라우팅 테이블이 존재한다.
```
예를 들어, Net.1에 존재하는 호스트가 Net.5에 존재하는 호스트에 데이터를 전송한다고 가정하자.

먼저 Net.1에 존재하는 호스트의 라우팅 테이블에 목적지가 Net.5인 데이터는 라우터 R1로 전송하라고 되어 있다면, 해당 데이터는 R1으로 간다.
라우터 R1의 라우팅 테이블을 보면, Net.5로 가는 데이터는 라우터 R6으로 중개하도록 되어 있으므로, 데이터는 라우터 R6으로 전달된다.

최종 경로는 R1 -> Net.2 -> R6 -> Net.5 순서이다.
```
</br>

### 3.2 적응 경로 배정
고정 경로 배정에서 라우팅 테이블의 경로 정보 변경은 네트워크 구성이 변경된 경우에만 가능하다.   
인터넷에서 사용되는 라우터는 **적응 경로 배정** (Adaptive Routing)을 채택한다.   

적응 경로 배정에서는 인터넷 연결 상태가 변하면 이를 데이터그램의 전달 경로에 반영한다.   
이때 결정에 영향을 주는 요소는 크게 두 가지이다.   
하나는 특정 네트워크나 라우터가 정상적으로 동작하지 않는 경우이고,   
다른 하나는, 네트워크의 특정 위치에서 혼잡이 발생하는 경우이다.   

적응 경로 배정은 이론적인 타당성에도 불구하고, 가볍게 넘길 수 없는 단점이 있다.   
경로를 결정하는 과정이 복잡해지면 이를 처리하는 라우터의 부담이 증가하는데, 인터넷처럼 복잡한 망에서 이것은 상당히 부담스러운 작업이다.   

네트워크에서의 변화는 내부적으로, 상태 정보에 대한 처리를 수반한다.   
그러나 특정 위치에서 어떤 변화가 발생했을 때, 네트워크의 모든 라우터에 동시 반영하는 것은 현실적으로 불가능하므로, 라우터들끼리 불일치성(Inconsistency)이 발생할 수 있다.   
이러한 불일치성을 해소하려면 라우터 사이의 정보 교환이 빠르게 자주 이루어져야 한다.    
하지만 이것은 네트워크 트래픽을 증가시키고, 라우터의 처리 부담을 증가시키는 결과를 초래한다.   
</br>

### 3.3 자율 시스템
라우팅 프로토콜과 관련해 자율 시스템(Autonomous System)이라는 개념이 존재한다.   
자율 시스템은 다수의 라우터로 구성할 수 있으며, 라우터들은 서로 공통의 라우팅 프로토콜을 사용해 정보를 교환한다.   
자율 시스템은 동일한 라우팅 특성에 의해 동작하는 논리적인 단일 구성체라고 볼 수 있다.   

자율 시스템 내부에서 사용하는 공통 프로토콜을 **내부 라우팅 프로토콜** (IRP, Interior Routing Protocol)이라 하며, 라우터끼리 라우팅 정보를 교환하는 용도로 사용한다.   

학교 같은 인터넷 환경에서는 각 건물을 라우터로 연결해 자율 시스템을 구성할 수 있고, 그림과 같이 외부의 자율 시스템과도 연결한다.
<img width="519" alt="스크린샷 2021-08-09 오후 9 43 33" src="https://user-images.githubusercontent.com/83942393/128707946-45eac333-7819-41e9-a557-00eda2f41dde.png">

이러한 구조에서는 자율 시스템이 사용하는 알고리즘과 라우팅 테이블 정보의 구조가 다를 수 있으므로, 자율 시스템 사이의 연동을 위한 방안을 고려해야 한다.   
자율 시스템들 간에 사용하는 라우팅 프로토콜을 일반적으로 **외부 라우팅 프로토콜**(ERP, Exterior Routing Protocol)이라 한다.   

그림에서 동일한 자율 시스템에 위치한 라우터 사이에는 내부 라우팅 프로토콜을 사용하고, 서로 다른 자율 시스템을 연결하는 라우터 사이에는 외부 라우팅 프로토콜을 사용한다.   
내부 라우팅 프로토콜에는 RIP, OSPF 등이 있고, 외부 라우팅 프로토콜에는 BGP 등이 있다.   
</br>

### 💎 04 서비스 품질(QoS)
네트워크에서의 품질(Quality)이란, 보통 데이터를 어느 정도로 신뢰성 있게 전송하는지를 의미한다.   
즉, 전송 과정에서의 데이터 분실, 전송 지연, 지연 값의 일관성(지터) 등을 기준으로 전송 품질을 판단할 수 있다.   
 
네트워크가 사용자에게 제공하는 서비스는 매우 다양하기 때문에, 네트워크 서비스 품질을 한마디로 규정하기는 어렵다.   
하지만 네트워크 서비스 제공자와 사용자 사이의 기본 서비스 품질은 특정 네트워크 서비스를 사용자에게 제공하는지 여부에서 출발한다.   
그리고 이를 바탕으로 서비스를 이용하는 데 있어서, 네트워크가 서비스의 특성에 부합하도록 어느 수준까지 올바르게 동작하는지를 판단해야 한다.   

사용자에게 제공되는 네트워크 서비스를 등급에 따라 분류할 수 있는데, 이를 서비스 클래스라 한다.   
서비스 클래스와 서비스 품질은 비슷한 의미로 해석할 수 있지만, 서비스 클래스가 서비스를 좀 더 세부적으로 분류하는 반면에, 서비스 품질은 포괄적이다.   

### 1. QoS 개요
인터넷 환경에서 전송 서비스 문제를 다루는 Qos(Quality of Service)는 중요한 고려 대상 중 하나이다.   
전송 서비스의 좋고 나쁨을 판단하는 기준은 사용자의 관점에 따라 다양하지만, 대부분 QoS로 정의할 수 있다.  
Qos 기준은 보통 연결형 서비스을 위한 것이지만, 비연결형 서비스에도 부분적으로 적용된다.   

Qos는 주로 전송 계층 사용자가 요청하므로 전송 계층 연결을 설정할 때 필요한 서비스의 정도를 매개변수로 표시한다.   
Qos 서비스를 지원하려면 전송 계층에 해당 기능을 구현해야 하는데, 하위의 네트워크 계층이 기능의 일부를 수행할 수 있으면 전송 계층의 역할이 그만큼 줄어든다.   
자주 언급되는 Qos 매개변수는 다음과 같다.   
</br>

> 연결 설정 지연
* 연결 설정 지연(Connection Establishment Delay)은 연결 설정을 위한 request 프리미티브 발생과 confirm 프리미티브 도착 사이의 경과 시간이다.
* 일반적으로 경과 시간이 짧을수록 서비스 품질이 좋으며, 네트워크 혼잡도 등의 영향을 많이 받는다.
* 연결 해제 요구에도 동일한 기준을 적용할 수 있다.
</br>

> 연결 설정 실패 확률
* 연결 설정 실패 확률(Connection Establishment Failure Probability)은 임의의 최대 연결 설정 지연 시간을 기준으로 연결 설정이 이루어지지 않을 확률이다.
* 연결 해제 요구에도 동일한 기준을 적용할 수 있다.
</br>

> 전송률
* 전송률(Throughput)은 임의의 시간 구간에서 초당 전송할 수 있는 바이트 수이다.
* 전송률은 양방향 값이 다를 수 있으므로, 별개로 다루어져야 한다.
</br>

> 전송 지연
* 전송 지연(Transit Dalay)은 송신 호스트가 전송한 데이터가 수신 호스트에 도착할 때까지 경과한 시간이다.
* 전송률처럼 양방향이 따로 다루어진다.
</br>

> 전송 오류율
* 전송 오류율(Residual Error Rate)은 임의의 시간 구간에서 전송된 총 데이터 수와 오류 발생 데이터 수의 비율이다.
</br>

> 우선순위
* 우선순위(Priority)는 다른 연결보다 먼저 처리함을 의미한다.
* 우선순위가 높은 연결이 우선순위가 낮은 연결보다 좋은 서비스를 제공받는다.
</br>

### 2. 인터넷에서의 QoS
IP 프로토콜은 원칙적으로 모든 패킷에 대해 동일한 기준을 적용해 목적지까지 데이터를 중개한다.   
특히, 데이터의 도착 순서나 데이터의 100% 수신 등을 보장하지 않기 때문에 버퍼를 사용해 이 문제를 해결한 후에 응용 계층으로 전달해야 한다.  
IP 프로토콜을 이용해 실시간 서비스를 제공하려면 약간의 시간을 미리 확보해 데이터를 버퍼에 저장하는 작업이 선행되어야 한다.   
따라서 첫 번째 데이터가 응용 환경에 전달되는 시점은 전송 지연시간보다 더 늦어진다.

QoS에서의 전송 데이터를 특징에 따라 여러 종류로 분류한다.   
예를 들어, 영상 데이터 등은 대용량 실시간 전송이 필요하지만, 전송 오류 문제에는 상대적으로 관대하다.   
그에 비해, 일반 컴퓨터 데이터는 실시간 기능이 필요 없지만, 전송 오류에 매우 민감하다.   
IP 프로토콜에는 특정 패킷의 우선순위를 조절하는 기능이 존재하지 않으므로, 모든 패킷을 동일한 기준으로 처리한다는 단점이 있다.   

IP 프로토콜에서 QoS를 지원하려면 각 패킷을 서로 다른 QoS 기준으로 구분할 수 있어야 하고, 라우터에서 이를 처리해야 한다.   
또 사용하는 대역의 요구 조건에 따라 패킷을 구분하고, 네트워크 자원의 할당도 그에 부합해야 한다.   

