### 🔆 Preview  
전화 시스템은 데이터 통신을 위한 프로토콜의 동작 원리를 이해하는 데 많은 도움이 된다.   
전화 시스템에서는 전화를 거는 사람(송신자)와 받는 사람(수신자)의 합의를 통해 연결을 설정한다.   
데이터 전송 단계인 통화 과정에서는 묵시적인 규칙에 따라 대화를 주고 받는 일련의 절차가 진행된다.   
양쪽이 동시에 말할 수 있는 양방향 통신 기능을 지원하지만, 실제로 두 사람이 동시에 말하는 경우는 거의 없고, 느낌이나 말의 내용 등에 따라 번갈아가며 대화한다.   
상대방이 한 말을 이해하지 못했거나 제대로 듣지 못한 경우에는 다시 묻는 방식을 통하여 오류를 바로 잡기도 한다.   

네트워크에서 데이터 전송 원리도 이와 비슷하다.   
통신 프로토콜에서 중점적으로 다루는 내용은 데이터 전송 오류와 속도 조절, 데이터의 전달 경로를 조절하는 라우팅 기능이다.   
전화 시스템에서 사람들이 무의식적으로 행하는 통화 기법이 통신 프로토콜 설계 과정에 그대로 반영되어 있다.   

인터넷의 동작 원리를 이해하려면, **계층 구조** 로 설계된 OSI 7계층 모델에 대한 학습이 선행되어야 한다.   
특히, 모듈화 설계 개념의 원리와 상하위 계층의 역할 분담에 대한 학습을 통하여, 각 프로토콜의 역할을 이해해야 한다.   
인터넷에서 사용하는 전송 프로토콜인 TCP, UDP, IP 프로토콜은 계층 구조 모델의 원리에 따라 설계되었으며, 기타 제어 프로토콜 및 전송 프로토콜의 관계도 동일한 원리에 따라 설계되었다.   

2장에서는 OSI 7계층 모델의 기본 원리인 **계층 구조의 개념** 에 대하여 설명한다.   
상하위 계층의 역할 분담에 따른 모듈화 설계는 복잡한 시스템을 단순하게 해준다.   
`7계층 모델은 이러한 원리에 따라 네트워크의 기능을 7개의 계층으로 나누어 설계한 표준안이다.`   
인터넷의 구조가 7계층 모델의 게층 구조와 어떤 관계가 있는지, 주요 프로토콜인 TCP/IP는 어떻게 구성되어 있는지 살펴본다.   
</br>

### 💎 01 계층 구조의 개념
네트워크에 연결된 시스템이 통신하려면, 정해진 규칙에 따라 데이터를 주고받아야 하는데, 이러한 일련의 규칙을 프로토콜(protocol)이라 한다.   
프로토콜의 동작 과정은 전송 오류율, 데이터 전달 경로, 전송 속도 등 다양한 외부 요인의 영향을 받는다.   
따라서 적절한 대응 방안을 마련해 효율적으로 관리해야 하는데, 프로토콜의 설계 과정은 모듈(module)화를 통하여 이루어진다.   
이렇게 함으로써 사용자에게 더 편리하고 간편한 통신 기능을 제공할 수 있다.   

### 1. 계층적 모듈 구조
일반적으로 복잡하고 큰 시스템의 기능은 특정 단위의 모듈로 나누어 설계한다.   
모듈은 독립적으로 동작하면서도 상호 유기적으로 통합될 수 있어야 한다.   
그러므로 모듈 사이에는 적절한 인터페이스가 필요하다.   

### 1.1 모듈화
컴퓨터 하드웨어는 CPU, 메모리, 하드디스크, LAN 카드(local area network card, 와이파이 수신기) 등과 같은 작은 부품들이 모여 하나의 시스템을 구성한다.   
복잡한 시스템을 기능별로 모듈화하면 시스템 구조가 단순해져서 전체 시스템을 이해하기 쉽다.   
또한 각 단위 모듈이 독립적인 기능을 수행하기 때문에, 고장이나 업그레이드 등의 상황에 손쉽게 대처할 수 있다.   

소프트웨어 측면에서 보면, 일반 프로그래밍 언어에서는 함수 개념을 사용해 전체 프로그램을 모듈화할 수 있다.   
함수별로 특정 기능을 독립적으로 수행하도록 함으로써, 각 함수가 개별적으로 설계되고 구현된다는 장점이 있다.   
함수 사이의 인터페이스는 함수의 매개변수에 의해서만 이루어지므로, 전체 시스템을 이해하기가 훨씬 쉽다.   

그림은 시스템 모듈화의 장점을 보여준다.   

<img src="https://user-images.githubusercontent.com/83942393/128332259-5f93af3a-750f-498c-adf7-856bdd6f64de.png" width="60%" height="60%"></img></br>

(a)처럼 전체 시스템을 기능에 따라 세 부분으로 나누어 설계할 수 있는데, 이때 각 모듈은 유기적으로 연결되어야 한다.   
```
B 모듈은 A 모듈과 곡선 모양의 인터페이스로 연결되고, C 모듈과는 톱니 모양의 인터페이스로 연결된다.
A와 C 모듈은 직접 연결되는 인터페이스가 없으며, B 모듈을 통해 간접적인 관계를 유지한다.
```
</br>

* 그림처럼 시스템을 모듈화하지 않았다면, 
* 한 부분만 고장 나도 전체 시스템을 교체해야 한다.
* 반면, 모듈화하면 (b)처럼 오류가 발생한 B 모듈만 교체해서 버전 2로 대체할 수 있다.
* (c)처럼 성능이나 기능을 개선해 버전 3으로 교체할 수도 있다.
* 이때 모듈 내부의 처리 과정은 임의의로 개선할 수 있으나, A와 C 모듈과의 인터페이스는 동일하게 유지해야 전체 시스템 동작에 영향을 주지 않는다.
</br>

### 1.2 계층 구조
분할된 모듈들은 협력 관계를 유지하면서 유기적으로 동작한다.   
대부분의 모듈 구조에서는 특정 모듈이 다른 모듈에 서비스를 제공하는 형식의 계층 구조를 이룬다.   
네트워크에서도 독립적인 고유 기능을 수행하는 모듈들이 상하위의 계층 구조로 연결되어 동작한다.   

<img src="https://user-images.githubusercontent.com/83942393/128333012-8b59e4d9-3715-4fd2-9bbd-8ced108e856d.png" width="25%" height="25%"></img></br>
(1) 계층 구조는 그림처럼 상위 계층이 하위 계층에 특정 서비스를 요청하는 방식으로 동작한다.   
(2) 요청을 받은 하위 계층은 해당 서비스를 실행하여 그 결과를 상위 계층에 돌려준다.   

하위 계층의 실행 결과는 상위 계층에 결과 값을 직접 전달하는 방식이 될 수도 있고, 주변 환경값을 변경하는 부수 효과(side effect) 방식일 수도 있다.   
```
자동차의 경우를 예로 들어보자.
운전자가 자동차의 속도를 줄이려면, 브레이크를 밟아야 하고, 브레이크를 누르는 정도에 따라 속도가 줄어든다. (부수 효과)
이 구조에서 운전자는 상위 계층에 해당되며, 자동차 내부에서 속도를 줄이는 기능은 하위 계층의 모듈이 된다.
운전자와 감속 모듈 사이에는 브레이크라는 인터페이스가 존재한다.
```
</br>

모듈화된 계층 구조 프로토콜은 다양한 장점이 있지만, 대표적인 장점 몇 가지 정리하면 다음과 같다.   
* 복잡하고 큰 시스템을 기능별로 작게 분류해서, 간단하고 작은 시스템으로 재구성할 수 있다.
  * 따라서 전체 시스템을 이해하기 쉽고, 시스템을 설계하고 구현하기도 편리하다.
* 상하 계층에 인접한 모듈 사이의 인터페이스를 포함하여, 분할된 모듈이 연동할 수 있는 표준 인터페이스를 제공한다.
  * 모듈 인터페이스는 가능한 단순하게 구현하여, 모듈들이 최대한 독립적으로 동작해야 한다.
  * 모듈의 독립성은 전체 시스템의 구조를 단순하게 만들어준다.
* 전송 매체 양단에 있는 호스트가 수행하는 프로토콜들은 좌우 대칭 구조이다.
  * 대칭 구조에서는 통신 양단에 위치하는 동일 계층 사이의 프로토콜을 단순할 수 있다.
* 각 계층의 기능 오류를 수정하거나 향상시켜야 하는 경우에 전체 시스템을 재작성하지 않고 해당 계층의 모듈만 교체하면 된다.
  * 즉, 상하 혹은 좌우 계층 간의 인터페이스를 유지하면, 특정 계층의 내부 변경이 다른 모듈의 동작에 영향을 미치지 않는다.
</br>

### 2. 프로토콜 설계 시 고려 사항
계층 구조의 통신 프로토콜을 설계할 때는 고려할 요소가 많다.   
대표적인 것이, 네트워크 호스트의 주소 표현 방법, 데이터 전송 과정에서의 오류 제어, 통신 양단 사이의 전송 속도를 제어하는 흐름 제어이다.   

주소 표현은 호스트를 유일하게 구분하는 용도로 사용한다.   
오류 제어는 전송 과정에서 데이터 분실, 데이터 변형 등의 오류가 발생했을 때, 데이터를 복구하는 데 사용한다.   
흐름 제어는 송신자가 데이터를 너무 빨리 보내어 수신자가 미처 처리하지 못하는 문제를 해결하기 위한 목적으로 사용한다.   
</br>

### 2.1 주소 표현
여러 호스트가 연결된 환경에서, 특정 호스트끼리 통신하려면, **상대방을 구분할 수 있는 방법** 이 필요하다.   
**시스템을 구분하여 지칭하기 위해서 이름을 부여** 하는 것을 **주소(address)체계** 라 한다. 주소 체계는 시스템의 설계 과정에서 맨 먼저 고려해야 하는 중요한 개념이다.  

```
예를 들어, 전화 시스템의 주소 표기 방법을 살펴보면, 전화번호 체계는 '국가 코드-지역 코드-번호' 형식으로 부여된다.
번호 체계가 국가라는 최상위 광역 코드에서 시작해, 영역을 점점 축소하는 방식으로 계층 구조에 따라 관리된다.
따라서 국가 코드와 지역 코드로 해당 전화기의 지리적 위치를 판단할 수 있다.(정보 함축성)

또 다른 주소 표현의 예로는 주민등록번호가 있다.
주민등록번호에는 다양한 정보가 포함되는데, yymmdd-abcdefg 형태에서 앞쪽의 yymmdd는 태어난 해의 연도, 월, 일을 의미한다. 뒤쪽의 a 는 성별을 구별
하는 용도로 사용되는데, 1이면 남자, 2이면 여자를 의미한다.
Y2K 문제로 인해 2000년 이후 출생자는 3이 남자, 4는 여자를 의미하도록 확장되었다. 즉, 1901년과 2001년에 태어난 사람은 yy로 구분하지 못하므로 a 값
으로 구분해야 한다. (유일성)
주소 체계를 결정할 때는 이와 같은 확장성을 반드시 고려해야 한다.(확장성)

+ 편리성
```
</br>

보통 호스트에도 주소를 하나씩 부여하지만, 다수의 호스트를 묶어 하나의 그룹 주소로 표기하기도 한다.   
이는 전통적인 환경이면서 현재도 가장 많이 사용하는 일대일(1:1) 통신과 더불어, 화상 회의 등을 지원하기 위한 일대다(1:n) 통신 환경도 필요하기 때문이다.    
일대다 통신의 대표적인 유형으로는 네트워크에 연결된 모든 호스트에 데이터를 전송할 수 있는 **브로드캐스팅(broadcasting)** 표기 방법과, 특정 사용자를 그룹으로 묶어 지칭하는 **멀티캐스팅(multicasting)** 표기 방법이 있다.   
</br>

### 2.2 오류 제어
네트워크에서는 데이터 송수신 과정에서 오류가 발생할 수 있다.   
전송 오류에는 데이터가 깨져서 도착하는 데이터 변형 오류와 데이터가 도착하지 못하는 데이터 분실 오류가 있다.   
전송 오류 문제를 해결하는 **오류 제어(error control)** 기능은 통신 프로토콜의 가장 기본적인 기능에 속한다.   

오류가 발생하는 1차 원인은 물리 계층의 전송 매체의 의한 물리적인 오류이다.   
이를 해결하기 위해서 데이터 링크 계층이 물리적은 전송 오류를 해결한다.   
그리고 상위 계층의 프로토콜이 수행될 때는 논리적인 전송 오류가 발생할 수 있으므로, 상위 계층에서도 전송 오류 문제를 다룬다.   

그림은 송신 호스트에서 보낸 데이터가 수신 호스트에 도착했을 때 발생할 수 있는 현상을 **세 가지 유형** 으로 설명한다.   

<img src="https://user-images.githubusercontent.com/83942393/128338471-7c94e956-3f4e-423c-a271-09c8f18e0d58.png" width="60%" height="60%"></img></br>

(a) 데이터가 오류 없이 도착하는 정상적인 경우   
(b) 데이터가 수신 호스트에 도착하지 못하는 데이터 분실 오류   
(c) 데이터의 내용이 변경되어 도착하는 데이터 변형 오류   

(b)처럼 데이터가 분실되는 원인은 매우 다양하다.   
전송 경로가 잘못되어 데이터가 엉뚱한 방향으로 전달될거나, 상위 계층의 논리적인 처리 과정에서 데이터를 분실할 수도 있다.    

데이터가 변형되거나 분실되는 오류가 발생되어 이를 해결하려면, 먼저 오류가 발생한 사실을 인지해야 한다.   
(b)의 경우에는 수신 호스트가 자신에게 데이터가 보내졌다는 사실을 인지하는 것이 쉽지 않기 때문에, 보통은 송신 호스트에서 오류를 감지하는 방법을 사용한다.   
(c)는 수신 호스트가 여러 방식의 오류 검출 기법을 이용해 오류를 검출할 수 있다.   
네트워크에서 전송 오류를 해결하는 일반적인 방법은 송신 호스트가 원래 데이터를 **재전송(retransmission)** 하는 것이다.   

물리적인 오류 외에도, 통신 프로토콜에서 사용하는 알고리즘의 성격에 의해 오류가 발생하기도 한다.    
예를 들어, 송신 호스트가 순차적으로 전송한 데이터의 순서가 뒤바뀌어 도착하는 경우이다.   
수신 호스트에서 도착 순서를 바로 잡으려면 데이터의 논리적인 순서를 의미하는 순서 번호 기능이 필요하다.   
</br>

### 2.3 흐름 제어






